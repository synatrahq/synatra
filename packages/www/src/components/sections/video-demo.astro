---
import postgresIcon from "../../assets/postgres.svg"
import mysqlIcon from "../../assets/mysql.svg"
import stripeIcon from "../../assets/stripe.svg"

const steps = [
  {
    time: 0,
    number: 1,
    title: "Connect",
    detail: "Add data sources",
  },
  {
    time: 14,
    number: 2,
    title: "Build",
    detail: "Vibe code with AI",
  },
  {
    time: 35,
    number: 3,
    title: "Assign",
    detail: "Add agent to channel",
  },
  {
    time: 43,
    number: 4,
    title: "Collaborate",
    detail: "Work together",
  },
]
---

<section id="demo" class="border-t border-surface-border-muted px-6 py-24">
  <div class="mx-auto max-w-6xl">
    <div class="text-center">
      <p class="text-xs font-medium text-gray-500">See it in action</p>
      <h2 class="mt-4 text-2xl font-semibold tracking-tight text-white md:text-3xl">
        From data to deployment in minutes
      </h2>
      <p class="mt-4 mx-auto max-w-2xl text-sm text-gray-400">
        Connect your data sources, build agents with natural language, and deploy them where your team works.
      </p>
    </div>

    <div class="mt-10 flex items-center justify-center gap-1">
      {steps.map((step, i) => (
        <button
          type="button"
          class="timeline-pill group relative flex items-center gap-2 rounded-full px-4 py-2 text-left transition-all duration-300"
          data-time={step.time}
          data-index={i}
        >
          <span class="timeline-number flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-surface-border text-[10px] font-bold text-gray-500 transition-all duration-300">
            {step.number}
          </span>
          <span class="timeline-title text-xs font-medium text-gray-500 transition-colors duration-300">{step.title}</span>
          <span class="timeline-detail hidden text-xs text-gray-600 sm:inline transition-colors duration-300">Â· {step.detail}</span>
        </button>
      ))}
    </div>

    <div class="mt-6 overflow-hidden rounded-xl border border-surface-border-muted bg-surface-bg-muted">
      <video
        id="demo-video"
        class="w-full"
        controls
        playsinline
        preload="metadata"
      >
        <source src="/videos/demo.mp4" type="video/mp4" />
      </video>
    </div>

    <div class="mt-8 flex items-center justify-center gap-4 text-xs text-gray-500">
      <span>Supports</span>
      <div class="flex items-center gap-3">
        <img src={postgresIcon.src} alt="PostgreSQL" class="h-4 w-4 opacity-60" />
        <img src={mysqlIcon.src} alt="MySQL" class="h-4 w-4 opacity-60" />
        <img src={stripeIcon.src} alt="Stripe" class="h-4 w-4 opacity-60" />
        <span class="text-gray-600">& more</span>
      </div>
    </div>
  </div>
</section>

<style>
  .timeline-pill {
    background: transparent;
  }

  .timeline-pill:hover {
    background: rgb(255 255 255 / 0.03);
  }

  .timeline-pill.active {
    background: rgb(255 255 255 / 0.06);
  }

  .timeline-pill.active .timeline-number {
    background: rgb(255 255 255 / 0.15);
    color: white;
  }

  .timeline-pill.active .timeline-title {
    color: white;
  }

  .timeline-pill.active .timeline-detail {
    color: rgb(156 163 175);
  }

  .timeline-pill.completed .timeline-number {
    background: rgb(16 185 129 / 0.2);
    color: rgb(52 211 153);
  }

  .timeline-pill.completed .timeline-title {
    color: rgb(156 163 175);
  }
</style>

<script>
  const video = document.getElementById("demo-video") as HTMLVideoElement
  const pills = document.querySelectorAll(".timeline-pill")
  const timestamps = [0, 14, 35, 43]

  function updateTimeline() {
    const currentTime = video.currentTime
    const duration = video.duration || 60

    pills.forEach((pill) => {
      const i = parseInt(pill.getAttribute("data-index") || "0", 10)
      const stepTime = timestamps[i]
      const nextTime = timestamps[i + 1] ?? duration

      pill.classList.remove("active", "completed")

      if (currentTime >= stepTime && currentTime < nextTime) {
        pill.classList.add("active")
      } else if (currentTime >= nextTime) {
        pill.classList.add("completed")
      }
    })
  }

  video.addEventListener("timeupdate", updateTimeline)
  video.addEventListener("loadedmetadata", updateTimeline)

  pills.forEach((pill) => {
    pill.addEventListener("click", () => {
      const time = parseFloat(pill.getAttribute("data-time") || "0")
      video.currentTime = time
      video.play()
    })
  })
</script>

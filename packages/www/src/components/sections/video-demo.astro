---
const chapters = [
  { time: 0, label: "Connect data" },
  { time: 14, label: "Build agent" },
  { time: 35, label: "Add to channel" },
  { time: 43, label: "Collaborate" },
]
---

<section id="demo" class="border-t border-surface-border-muted px-6 py-20">
  <div class="mx-auto max-w-5xl">
    <p class="text-xs font-medium text-gray-500">Watch it work</p>
    <h2 class="mt-4 max-w-2xl text-2xl font-semibold tracking-tight text-white md:text-3xl">
      Your new coworker ships in minutes
    </h2>
    <p class="mt-4 max-w-2xl text-sm text-gray-400">
      Connect Postgres, write tools with AI, deploy to your team. No frontend code required.
    </p>

    <div class="mt-12">
      <div class="overflow-hidden rounded-xl border border-surface-border-muted bg-surface-bg-muted">
        <video
          id="demo-video"
          class="w-full"
          controls
          playsinline
          preload="metadata"
        >
          <source src="/videos/demo.mp4" type="video/mp4" />
        </video>
      </div>

      <nav id="chapter-nav" class="mt-4 flex gap-1" aria-label="Video chapters">
        {chapters.map((ch, i) => (
          <button
            type="button"
            class="chapter-btn flex-1 rounded-md bg-transparent py-2 text-center text-xs text-gray-500 transition-colors"
            data-time={ch.time}
            data-index={i}
          >
            {ch.label}
          </button>
        ))}
      </nav>
    </div>
  </div>
</section>

<style>
  .chapter-btn {
    position: relative;
    background: transparent;
    border: none;
  }

  .chapter-btn::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: transparent;
    border-radius: 1px;
    transition: background 0.2s;
  }

  .chapter-btn:hover {
    color: rgb(156 163 175);
  }

  .chapter-btn.active {
    color: white;
  }

  .chapter-btn.active::after {
    background: white;
  }

  .chapter-btn.completed {
    color: rgb(107 114 128);
  }

  .chapter-btn.completed::after {
    background: rgb(55 65 81);
  }
</style>

<script>
  const video = document.getElementById("demo-video") as HTMLVideoElement
  const buttons = document.querySelectorAll(".chapter-btn")
  const times = [0, 14, 35, 43]

  function update() {
    const t = video.currentTime
    const d = video.duration || 60

    buttons.forEach((btn, i) => {
      const start = times[i]
      const end = times[i + 1] ?? d

      btn.classList.remove("active", "completed")
      if (t >= start && t < end) btn.classList.add("active")
      else if (t >= end) btn.classList.add("completed")
    })
  }

  video.addEventListener("timeupdate", update)
  video.addEventListener("loadedmetadata", update)

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      video.currentTime = parseFloat(btn.getAttribute("data-time") || "0")
      video.play()
    })
  })
</script>

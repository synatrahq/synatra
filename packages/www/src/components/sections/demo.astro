---
import { PhCheckCircle, PhRobot, PhChartPie, PhTrendUp } from "phosphor-icons-astro"
---

<section id="demo-section" class="border-t border-surface-border-muted px-6 py-20 grid-dots">
  <div class="mx-auto max-w-5xl">
    <p class="text-xs font-medium text-gray-500">Use cases</p>
    <h2 class="mt-4 max-w-2xl text-2xl font-semibold tracking-tight text-white md:text-3xl">
      See what your coworker can do
    </h2>
    <p class="mt-4 max-w-2xl text-sm text-gray-400">
      Just tell your AI what you need. It generates the UI, fetches the data, and asks when it needs you.
    </p>

    <div class="mt-12 space-y-16 demo-cases">
      <div class="demo-case grid gap-8 lg:grid-cols-2 lg:items-start" data-case="0">
        <div class="space-y-4">
          <div class="inline-flex items-center gap-2 rounded-full bg-blue-500/10 px-3 py-1 text-xs text-blue-400">
            Use case: Customer refund
          </div>
          <h3 class="text-xl font-medium text-white">"Process a refund for order #4521"</h3>
          <p class="text-sm text-gray-400">
            The agent looks up the order, checks the customer history, and generates a refund form with all the details pre-filled. You just review and approve.
          </p>
          <div class="flex items-center gap-2 text-xs text-gray-500">
            <PhCheckCircle class="h-4 w-4 text-emerald-500" />
            <span>Stripe integration</span>
            <span class="text-gray-700">·</span>
            <span>Form widget generated</span>
            <span class="text-gray-700">·</span>
            <span>Approval required</span>
          </div>
        </div>
        <div class="rounded-xl border border-surface-border-muted bg-surface-bg-muted overflow-hidden">
          <div class="flex items-center gap-2 border-b border-surface-border-muted bg-surface-bg-muted px-4 py-2">
            <div class="flex h-6 w-6 items-center justify-center rounded-full bg-blue-500/20"><PhRobot class="h-3.5 w-3.5 text-blue-400" /></div>
            <span class="text-xs font-medium text-white">Support Agent</span>
            <span class="demo-status ml-auto rounded bg-gray-700 px-2 py-0.5 text-[10px] text-gray-400 transition-all duration-300" data-final-text="Waiting approval" data-final-class="bg-amber-500/20 text-amber-400">Idle</span>
          </div>
          <div class="p-4 space-y-3">
            <div class="demo-msg flex gap-3" data-step="0">
              <div class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-gray-700 text-[10px]">You</div>
              <div class="rounded-lg bg-surface-border px-3">
                <p class="demo-user-msg text-xs text-gray-300" data-text="Process a refund for order #4521. Customer says item arrived damaged.">Process a refund for order #4521. Customer says item arrived damaged.</p>
              </div>
            </div>
            <div class="demo-msg flex gap-3" data-step="1">
              <div class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-blue-500/20"><PhRobot class="h-3 w-3 text-blue-400" /></div>
              <div class="flex-1 space-y-2">
                <p class="demo-ai-msg text-xs text-gray-400" data-text="Found the order. Here's the refund form:">Found the order. Here's the refund form:</p>
                <div class="demo-msg demo-widget rounded-lg border border-surface-border bg-surface-bg p-3 space-y-2" data-step="2">
                  <div class="demo-widget-item flex justify-between text-xs">
                    <span class="text-gray-500">Order ID</span>
                    <span class="text-white font-mono">#4521</span>
                  </div>
                  <div class="demo-widget-item flex justify-between text-xs">
                    <span class="text-gray-500">Customer</span>
                    <span class="text-white">john@acme.com</span>
                  </div>
                  <div class="demo-widget-item flex justify-between text-xs">
                    <span class="text-gray-500">Amount</span>
                    <span class="text-white font-medium">$149.00</span>
                  </div>
                  <div class="demo-widget-item pt-2 border-t border-surface-border">
                    <label class="text-[10px] text-gray-500 block mb-1">Reason</label>
                    <div class="rounded bg-surface-bg-elevated border border-surface-border px-2 py-1.5 text-xs text-gray-300">Item arrived damaged</div>
                  </div>
                </div>
                <div class="demo-msg flex gap-2" data-step="3">
                  <button class="rounded bg-emerald-600 px-3 py-1.5 text-xs font-medium text-white">Approve Refund</button>
                  <button class="rounded border border-surface-border px-3 py-1.5 text-xs text-gray-400">Reject</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="demo-case grid gap-8 lg:grid-cols-2 lg:items-start" data-case="1">
        <div class="space-y-4 lg:order-2">
          <div class="inline-flex items-center gap-2 rounded-full bg-purple-500/10 px-3 py-1 text-xs text-purple-400">
            Use case: Data analysis
          </div>
          <h3 class="text-xl font-medium text-white">"Show me failed payments this week"</h3>
          <p class="text-sm text-gray-400">
            The agent queries your database, displays the results in a sortable table, and lets you select rows for bulk actions. No SQL knowledge required.
          </p>
          <div class="flex items-center gap-2 text-xs text-gray-500">
            <PhCheckCircle class="h-4 w-4 text-emerald-500" />
            <span>Postgres query</span>
            <span class="text-gray-700">·</span>
            <span>Table widget generated</span>
            <span class="text-gray-700">·</span>
            <span>Selectable rows</span>
          </div>
        </div>
        <div class="rounded-xl border border-surface-border-muted bg-surface-bg-muted overflow-hidden lg:order-1">
          <div class="flex items-center gap-2 border-b border-surface-border-muted bg-surface-bg-muted px-4 py-2">
            <div class="flex h-6 w-6 items-center justify-center rounded-full bg-purple-500/20"><PhChartPie class="h-3.5 w-3.5 text-purple-400" /></div>
            <span class="text-xs font-medium text-white">Finance Agent</span>
            <span class="demo-status ml-auto rounded bg-gray-700 px-2 py-0.5 text-[10px] text-gray-400 transition-all duration-300" data-final-text="Input needed" data-final-class="bg-blue-500/20 text-blue-400">Idle</span>
          </div>
          <div class="p-4 space-y-3">
            <div class="demo-msg flex gap-3" data-step="0">
              <div class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-gray-700 text-[10px]">You</div>
              <div class="rounded-lg bg-surface-border px-3">
                <p class="demo-user-msg text-xs text-gray-300" data-text="Show me all failed payments from this week">Show me all failed payments from this week</p>
              </div>
            </div>
            <div class="demo-msg flex gap-3" data-step="1">
              <div class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-purple-500/20"><PhChartPie class="h-3 w-3 text-purple-400" /></div>
              <div class="flex-1 space-y-2">
                <p class="demo-ai-msg text-xs text-gray-400" data-text="Found 5 failed payments. Select rows to retry:">Found 5 failed payments. Select rows to retry:</p>
                <div class="demo-msg demo-widget rounded-lg border border-surface-border bg-surface-bg overflow-hidden" data-step="2">
                  <table class="w-full text-[11px]">
                    <thead class="demo-widget-item bg-surface-bg-elevated">
                      <tr class="text-gray-500">
                        <th class="w-8 px-2 py-1.5"></th>
                        <th class="px-2 py-1.5 text-left font-medium">Customer</th>
                        <th class="px-2 py-1.5 text-left font-medium">Amount</th>
                        <th class="px-2 py-1.5 text-left font-medium">Error</th>
                      </tr>
                    </thead>
                    <tbody class="text-gray-300">
                      <tr class="demo-widget-item border-t border-surface-border bg-blue-500/5">
                        <td class="px-2 py-1.5"><div class="h-3 w-3 rounded border-2 border-blue-500 bg-blue-500 flex items-center justify-center"><svg class="h-2 w-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg></div></td>
                        <td class="px-2 py-1.5">Acme Corp</td>
                        <td class="px-2 py-1.5 font-mono">$2,400</td>
                        <td class="px-2 py-1.5 text-red-400">Card declined</td>
                      </tr>
                      <tr class="demo-widget-item border-t border-surface-border">
                        <td class="px-2 py-1.5"><div class="h-3 w-3 rounded border border-gray-600"></div></td>
                        <td class="px-2 py-1.5">StartupXYZ</td>
                        <td class="px-2 py-1.5 font-mono">$99</td>
                        <td class="px-2 py-1.5 text-red-400">Insufficient funds</td>
                      </tr>
                      <tr class="demo-widget-item border-t border-surface-border bg-blue-500/5">
                        <td class="px-2 py-1.5"><div class="h-3 w-3 rounded border-2 border-blue-500 bg-blue-500 flex items-center justify-center"><svg class="h-2 w-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg></div></td>
                        <td class="px-2 py-1.5">DevShop Inc</td>
                        <td class="px-2 py-1.5 font-mono">$499</td>
                        <td class="px-2 py-1.5 text-red-400">Card expired</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <p class="demo-msg text-[10px] text-gray-500" data-step="3">2 of 5 selected</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="demo-case grid gap-8 lg:grid-cols-2 lg:items-start" data-case="2">
        <div class="space-y-4">
          <div class="inline-flex items-center gap-2 rounded-full bg-emerald-500/10 px-3 py-1 text-xs text-emerald-400">
            Use case: Reporting
          </div>
          <h3 class="text-xl font-medium text-white">"Generate this month's revenue report"</h3>
          <p class="text-sm text-gray-400">
            The agent pulls data from Stripe, visualizes it with charts, and asks if you want to export or share with the team. Full report, zero manual work.
          </p>
          <div class="flex items-center gap-2 text-xs text-gray-500">
            <PhCheckCircle class="h-4 w-4 text-emerald-500" />
            <span>Stripe analytics</span>
            <span class="text-gray-700">·</span>
            <span>Chart widget generated</span>
            <span class="text-gray-700">·</span>
            <span>Export options</span>
          </div>
        </div>
        <div class="rounded-xl border border-surface-border-muted bg-surface-bg-muted overflow-hidden">
          <div class="flex items-center gap-2 border-b border-surface-border-muted bg-surface-bg-muted px-4 py-2">
            <div class="flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500/20"><PhTrendUp class="h-3.5 w-3.5 text-emerald-400" /></div>
            <span class="text-xs font-medium text-white">Revenue Agent</span>
            <span class="demo-status ml-auto rounded bg-gray-700 px-2 py-0.5 text-[10px] text-gray-400 transition-all duration-300" data-final-text="Completed" data-final-class="bg-emerald-500/20 text-emerald-400">Idle</span>
          </div>
          <div class="p-4 space-y-3">
            <div class="demo-msg flex gap-3" data-step="0">
              <div class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-gray-700 text-[10px]">You</div>
              <div class="rounded-lg bg-surface-border px-3">
                <p class="demo-user-msg text-xs text-gray-300" data-text="Generate the monthly revenue report for December">Generate the monthly revenue report for December</p>
              </div>
            </div>
            <div class="demo-msg flex gap-3" data-step="1">
              <div class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-emerald-500/20"><PhTrendUp class="h-3 w-3 text-emerald-400" /></div>
              <div class="flex-1 space-y-2">
                <p class="demo-ai-msg text-xs text-gray-400" data-text="Here's your December revenue report:">Here's your December revenue report:</p>
                <div class="demo-msg demo-widget rounded-lg border border-surface-border bg-surface-bg p-3 space-y-3" data-step="2">
                  <div class="demo-widget-item grid grid-cols-3 gap-2 text-center">
                    <div class="rounded bg-surface-bg-elevated p-2">
                      <p class="text-[10px] text-gray-500">Total Revenue</p>
                      <p class="text-sm font-semibold text-white">$127,430</p>
                    </div>
                    <div class="rounded bg-surface-bg-elevated p-2">
                      <p class="text-[10px] text-gray-500">New Customers</p>
                      <p class="text-sm font-semibold text-white">+48</p>
                    </div>
                    <div class="rounded bg-surface-bg-elevated p-2">
                      <p class="text-[10px] text-gray-500">Growth</p>
                      <p class="text-sm font-semibold text-emerald-400">+12.3%</p>
                    </div>
                  </div>
                  <div class="demo-widget-item h-20 flex items-end gap-1 px-2">
                    <div class="flex-1 bg-emerald-500/60 rounded-t" style="height: 40%"></div>
                    <div class="flex-1 bg-emerald-500/60 rounded-t" style="height: 55%"></div>
                    <div class="flex-1 bg-emerald-500/60 rounded-t" style="height: 45%"></div>
                    <div class="flex-1 bg-emerald-500/60 rounded-t" style="height: 70%"></div>
                    <div class="flex-1 bg-emerald-500/60 rounded-t" style="height: 85%"></div>
                    <div class="flex-1 bg-emerald-500 rounded-t" style="height: 100%"></div>
                  </div>
                  <div class="demo-widget-item flex justify-between text-[9px] text-gray-500 px-2">
                    <span>Jul</span><span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span>
                  </div>
                </div>
                <div class="demo-msg flex gap-2" data-step="3">
                  <button class="rounded bg-surface-border border border-surface-border px-3 py-1.5 text-xs text-gray-300">Export PDF</button>
                  <button class="rounded bg-surface-border border border-surface-border px-3 py-1.5 text-xs text-gray-300">Share with team</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-12 rounded-lg border border-emerald-900/30 bg-emerald-950/10 p-4">
      <p class="text-sm text-gray-300">
        <span class="font-medium text-emerald-400">Zero maintenance:</span> Every interface is generated fresh. No dashboards to update. No forms to maintain. The AI creates exactly what you need, when you need it.
      </p>
    </div>
  </div>
</section>

<style>
  .demo-msg {
    opacity: 0;
    transform: translateY(12px);
    transition:
      opacity 0.4s var(--ease-out),
      transform 0.4s var(--ease-out);
  }

  .demo-msg.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .demo-cursor {
    display: inline-block;
    width: 2px;
    height: 12px;
    background: currentColor;
    animation: demo-blink 0.8s step-end infinite;
    vertical-align: text-bottom;
    margin-left: 1px;
  }

  @keyframes demo-blink {
    50% { opacity: 0; }
  }

  .demo-status.is-typing {
    background: rgb(59 130 246 / 0.2);
    color: rgb(96 165 250);
  }

  .demo-status.is-thinking {
    background: rgb(16 185 129 / 0.2);
    color: rgb(52 211 153);
  }

  .demo-widget-item {
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.3s var(--ease-out), transform 0.3s var(--ease-out);
  }

  .demo-widget-item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .demo-msg,
    .demo-widget-item {
      opacity: 1;
      transform: none;
      transition: none;
    }
    .demo-cursor {
      animation: none;
      opacity: 1;
    }
  }
</style>

<script>
  const cases = document.querySelectorAll(".demo-case")

  if (cases.length && !window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
    const STEPS = 4
    const USER_TYPING_SPEED = 10
    const AI_TYPING_SPEED = 15
    let ticking = false

    interface CaseState {
      step: number
      typing: boolean
      done: boolean
    }

    const state = new Map<Element, CaseState>()
    cases.forEach((c) => state.set(c, { step: -1, typing: false, done: false }))

    const typeText = (el: HTMLElement, text: string, speed: number): Promise<void> => {
      return new Promise((resolve) => {
        const height = el.offsetHeight
        el.style.minHeight = height + "px"

        let i = 0
        el.innerHTML = '<span class="demo-cursor"></span>'

        const type = () => {
          if (i < text.length) {
            el.innerHTML = text.slice(0, i + 1) + '<span class="demo-cursor"></span>'
            i++
            setTimeout(type, speed + Math.random() * 5)
          } else {
            el.textContent = text
            el.style.minHeight = ""
            resolve()
          }
        }
        type()
      })
    }

    const animateWidgetItems = async (widget: Element) => {
      const items = widget.querySelectorAll(".demo-widget-item")
      for (const item of items) {
        item.classList.add("is-visible")
        await new Promise((r) => setTimeout(r, 100))
      }
    }

    const animateCase = async (caseEl: Element) => {
      const s = state.get(caseEl)!
      if (s.done || s.typing) return

      s.typing = true

      const userMsgEl = caseEl.querySelector(".demo-user-msg") as HTMLElement | null
      const aiMsgEl = caseEl.querySelector(".demo-ai-msg") as HTMLElement | null
      const statusEl = caseEl.querySelector(".demo-status") as HTMLElement | null
      const msgs = caseEl.querySelectorAll(".demo-msg")
      const widgets = caseEl.querySelectorAll(".demo-widget")

      for (let step = 0; step < STEPS; step++) {
        if (step === 0 && userMsgEl) {
          if (statusEl) {
            statusEl.textContent = "Typing..."
            statusEl.classList.add("is-typing")
          }
          const parent = userMsgEl.closest(".demo-msg")
          parent?.classList.add("is-visible")
          await typeText(userMsgEl, userMsgEl.dataset.text || "", USER_TYPING_SPEED)
        } else if (step === 1 && aiMsgEl) {
          if (statusEl) {
            statusEl.textContent = "Thinking..."
            statusEl.classList.remove("is-typing")
            statusEl.classList.add("is-thinking")
          }
          const parent = aiMsgEl.closest(".demo-msg")
          parent?.classList.add("is-visible")
          await typeText(aiMsgEl, aiMsgEl.dataset.text || "", AI_TYPING_SPEED)
        } else if (step === 2) {
          for (const widget of widgets) {
            widget.classList.add("is-visible")
            await animateWidgetItems(widget)
          }
        }

        msgs.forEach((msg) => {
          const msgStep = parseInt(msg.getAttribute("data-step") || "0", 10)
          if (msgStep <= step) {
            msg.classList.add("is-visible")
          }
        })

        s.step = step
      }

      if (statusEl) {
        statusEl.classList.remove("is-typing", "is-thinking", "bg-gray-700", "text-gray-400")
        const finalClass = statusEl.dataset.finalClass || ""
        finalClass.split(" ").forEach((c) => c && statusEl.classList.add(c))
        statusEl.textContent = statusEl.dataset.finalText || ""
      }

      s.typing = false
      s.done = true
    }

    const checkCase = (caseEl: Element) => {
      const s = state.get(caseEl)!
      if (s.done) return

      const rect = caseEl.getBoundingClientRect()
      const windowHeight = window.innerHeight

      if (rect.top < windowHeight * 0.8 && rect.bottom > 0) {
        animateCase(caseEl)
      }
    }

    const handleScroll = () => {
      if (ticking) return
      ticking = true

      requestAnimationFrame(() => {
        cases.forEach(checkCase)
        ticking = false
      })
    }

    let listening = false

    const observer = new IntersectionObserver(
      (entries) => {
        const anyVisible = entries.some((e) => e.isIntersecting)
        if (anyVisible && !listening) {
          listening = true
          window.addEventListener("scroll", handleScroll, { passive: true })
          handleScroll()
        } else if (!anyVisible && listening) {
          listening = false
          window.removeEventListener("scroll", handleScroll)
        }
      },
      { threshold: 0 }
    )

    cases.forEach((c) => observer.observe(c))
  } else {
    const userMsgs = document.querySelectorAll(".demo-user-msg")
    const aiMsgs = document.querySelectorAll(".demo-ai-msg")
    const statuses = document.querySelectorAll(".demo-status")
    userMsgs.forEach((el) => {
      const e = el as HTMLElement
      e.textContent = e.dataset.text || ""
    })
    aiMsgs.forEach((el) => {
      const e = el as HTMLElement
      e.textContent = e.dataset.text || ""
    })
    statuses.forEach((el) => {
      const e = el as HTMLElement
      e.classList.remove("bg-gray-700", "text-gray-400")
      const finalClass = e.dataset.finalClass || ""
      finalClass.split(" ").forEach((c) => c && e.classList.add(c))
      e.textContent = e.dataset.finalText || ""
    })
    document.querySelectorAll(".demo-msg, .demo-widget-item").forEach((el) => {
      el.classList.add("is-visible")
    })
  }
</script>

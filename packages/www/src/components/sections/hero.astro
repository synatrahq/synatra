---
import { Image } from "astro:assets"
import heroBackground from "../../assets/hero_background.webp"
import GithubIconLight from "../../assets/github_light.svg"
import GithubIconDark from "../../assets/github_dark.svg"
import PostgresIcon from "../../assets/postgres.svg"
import MysqlIcon from "../../assets/mysql.svg"
import StripeIcon from "../../assets/stripe.svg"
import IntercomIconLight from "../../assets/intercom_light.svg"
import IntercomIconDark from "../../assets/intercom_dark.svg"
---

<style>
  .hero-bg {
    opacity: 0;
    transition: opacity 0.4s ease-out;
  }
  .hero-bg.loaded {
    opacity: 0.4;
  }

  .typewriter-container {
    color: var(--color-gray-400);
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    border-bottom: 2px solid transparent;
    padding-bottom: 2px;
  }

  .typewriter-container.has-text {
    border-bottom-color: var(--color-gray-500);
  }

  .typewriter-text {
    display: inline;
  }

  .typewriter-text:empty::before {
    content: "\200B";
  }

  .typewriter-icons {
    position: relative;
    width: 0.9em;
    height: 0.9em;
    flex-shrink: 0;
    display: none;
    margin-left: 0.1em;
  }

  .typewriter-icons.is-visible {
    display: block;
  }

  .typewriter-icon {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 9999px;
    background-color: #faf9f7;
    border: 1px solid #e0e0e0;
    opacity: 0;
  }

  .typewriter-icon.is-visible {
    opacity: 1;
  }

  .typewriter-icon svg {
    width: 60%;
    height: 60%;
  }

  .typewriter-quote {
    color: white;
    display: none;
  }

  .typewriter-quote.is-visible {
    display: inline;
  }

  .typewriter-cursor {
    display: inline-block;
    width: 3px;
    height: 0.7em;
    background: var(--color-gray-400);
    animation: hero-blink 0.8s step-end infinite;
  }

  @keyframes hero-blink {
    50% { opacity: 0; }
  }

  @media (prefers-reduced-motion: reduce) {
    .typewriter-cursor {
      animation: none;
    }
  }
</style>

<section class="relative px-6 pb-24 pt-32 md:pt-40 overflow-hidden">
  <div class="absolute inset-0 -z-10">
    <Image src={heroBackground} alt="" id="hero-bg" class="hero-bg absolute inset-0 h-full w-full object-cover" style="object-position: center 18%;" loading="eager" fetchpriority="high" widths={[640, 1280, 1920]} sizes="100vw" />
    <div class="absolute inset-0 bg-gradient-to-b from-surface-bg/50 via-surface-bg/60 to-surface-bg"></div>
  </div>
  <div class="mx-auto max-w-5xl relative">
    <div class="inline-flex items-center gap-2 rounded-full border border-surface-border bg-surface-bg-muted backdrop-blur-sm px-3 py-1 text-xs text-gray-400">
      <span class="inline-block h-1.5 w-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
      Open Source & Early Access
    </div>
    <h1 class="mt-6 text-3xl font-semibold tracking-tight text-white sm:text-4xl md:text-5xl">
      <span class="sm:block">"Hey AI,</span>
      <span>I need to </span>
      <br class="sm:hidden" />
      <span id="hero-typewriter" class="typewriter-container whitespace-nowrap">
        <span class="typewriter-text"></span>
        <span class="typewriter-icons">
          <span class="typewriter-icon" data-icon="postgres">
            <PostgresIcon />
          </span>
          <span class="typewriter-icon" data-icon="mysql">
            <MysqlIcon />
          </span>
          <span class="typewriter-icon" data-icon="stripe">
            <StripeIcon />
          </span>
          <span class="typewriter-icon" data-icon="github">
            <GithubIconLight />
          </span>
          <span class="typewriter-icon" data-icon="intercom">
            <IntercomIconLight />
          </span>
        </span>
        <span class="typewriter-quote">"</span>
        <span class="typewriter-cursor"></span>
      </span>
    </h1>
    <p class="mt-6 max-w-xl text-base text-gray-400">
      Stop building internal tools. Just talk to your AI. It handles the work, generates the UI, and asks when it needs you.
    </p>
    <div class="mt-8 flex flex-wrap items-center gap-4">
      <a href="https://synatrahq.com/login" class="inline-flex items-center rounded-full bg-white px-5 py-2.5 text-sm font-medium text-gray-950 transition-all hover:bg-gray-200 hover:scale-105 shadow-lg shadow-white/10">
        Get started
      </a>
      <a href="https://github.com/synatrahq/synatra" class="inline-flex items-center gap-2 rounded-full border border-surface-border bg-surface-bg-elevated/50 backdrop-blur-sm px-5 py-2.5 text-sm font-medium text-gray-300 transition-all hover:border-surface-border hover:text-white">
        <GithubIconDark class="h-4 w-4" />
        Star on GitHub
      </a>
    </div>
    <div class="mt-10 flex flex-col gap-3">
      <p class="text-xs text-gray-500">Connects to</p>
      <div class="flex flex-wrap items-center gap-5">
        <PostgresIcon class="h-5 w-5 opacity-90 hover:opacity-100 transition-opacity" />
        <MysqlIcon class="h-5 w-5 opacity-90 hover:opacity-100 transition-opacity" />
        <StripeIcon class="h-5 w-5 opacity-90 hover:opacity-100 transition-opacity" />
        <GithubIconDark class="h-5 w-5 opacity-90 hover:opacity-100 transition-opacity" />
        <IntercomIconDark class="h-5 w-5 opacity-90 hover:opacity-100 transition-opacity" />
      </div>
    </div>
  </div>
</section>

<script>
  const img = document.getElementById("hero-bg") as HTMLImageElement
  if (img?.complete) img.classList.add("loaded")
  else img?.addEventListener("load", () => img.classList.add("loaded"))

  const typewriter = document.getElementById("hero-typewriter")

  if (typewriter && !window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
    const textEl = typewriter.querySelector(".typewriter-text") as HTMLElement
    const quoteEl = typewriter.querySelector(".typewriter-quote") as HTMLElement
    const iconsContainer = typewriter.querySelector(".typewriter-icons") as HTMLElement
    const icons = typewriter.querySelectorAll(".typewriter-icon")

    const isMobile = window.innerWidth < 640

    const phrases = [
      { text: "find churned users in ", icon: "postgres" },
      { text: "extend Acme's trial in ", icon: "mysql" },
      { text: isMobile ? "refund #4521 on " : "refund order #4521 on ", icon: "stripe" },
      { text: isMobile ? "check issue #1234 on " : "check if #1234 is a bug on ", icon: "github" },
      { text: isMobile ? "reply to tickets on " : "reply to urgent tickets on ", icon: "intercom" },
    ]

    let current = 0
    let charIndex = 0
    let isDeleting = false
    let pauseEnd = 0

    const showIcon = (name: string) => {
      icons.forEach((icon) => {
        if ((icon as HTMLElement).dataset.icon === name) {
          icon.classList.add("is-visible")
        } else {
          icon.classList.remove("is-visible")
        }
      })
      iconsContainer.classList.add("is-visible")
    }

    const hideIcons = () => {
      iconsContainer.classList.remove("is-visible")
      icons.forEach((icon) => icon.classList.remove("is-visible"))
    }

    const tick = () => {
      const now = performance.now()
      if (now < pauseEnd) {
        requestAnimationFrame(tick)
        return
      }

      const phrase = phrases[current]

      if (!isDeleting) {
        charIndex++
        textEl.textContent = phrase.text.slice(0, charIndex)
        typewriter.classList.add("has-text")

        if (charIndex >= phrase.text.length) {
          showIcon(phrase.icon)
          quoteEl.classList.add("is-visible")
          isDeleting = true
          pauseEnd = now + 2000
        } else {
          pauseEnd = now + 30 + Math.random() * 40
        }
      } else {
        if (charIndex === phrase.text.length) {
          quoteEl.classList.remove("is-visible")
          hideIcons()
        }

        charIndex--
        textEl.textContent = phrase.text.slice(0, charIndex)

        if (charIndex <= 0) {
          typewriter.classList.remove("has-text")
          isDeleting = false
          current = (current + 1) % phrases.length
          pauseEnd = now + 300
        } else {
          pauseEnd = now + 15 + Math.random() * 20
        }
      }

      requestAnimationFrame(tick)
    }

    requestAnimationFrame(tick)
  } else if (typewriter) {
    const textEl = typewriter.querySelector(".typewriter-text") as HTMLElement
    const quoteEl = typewriter.querySelector(".typewriter-quote") as HTMLElement
    const iconsContainer = typewriter.querySelector(".typewriter-icons") as HTMLElement
    const firstIcon = typewriter.querySelector('[data-icon="postgres"]')

    textEl.textContent = "find churned users in "
    typewriter.classList.add("has-text")
    quoteEl.classList.add("is-visible")
    iconsContainer.classList.add("is-visible")
    firstIcon?.classList.add("is-visible")
    typewriter.querySelector(".typewriter-cursor")?.remove()
  }
</script>
